function donut_chart(e,c,d,b){if(null==d)window.console&&console.log("selector fail");else if(null==b)window.console&&console.log("data invalidate or null");else{var h=d3.scale.linear().domain([0.5,100]).range([1,50]),b=b.filter(function(a){return 0<a.val}),b=b.map(function(a){return{group:a.group,name:a.name,val:a.val,type:a.type,display_val:a.val}}),f=e||400,g=c||400,c=Math.min(f,g)/2.8,i=c+10,j=c-Math.max(f,g)/6;d3.scale.category20();var e=d3.layout.pie(),k=d3.svg.arc().innerRadius(0.95*c).outerRadius(c),
l=d3.svg.arc().innerRadius(0.7*c).outerRadius(0.87*c),d=d3.select(d).append("svg:svg").data([b]).attr("width",f).attr("height",g).append("svg:g").attr("transform","translate(2,-20)"),b=d.selectAll("g.arc.outer").data(e.value(function(a){return"outer"==a.group?h(a.val):0})).enter().append("svg:g").attr("class","arc outer").attr("transform","translate("+(c+50)+","+(c+50)+")");b.append("svg:path").attr("class",function(a){return a.data.type}).attr("d",k);b.append("svg:text").attr("transform",function(a){var c=
k.centroid(a),a=c[0],c=c[1],b=Math.sqrt(a*a+c*c);return"translate("+a/b*i+","+c/b*i+")"}).attr("dy",".35em").attr("class",function(a){return"text "+a.data.type+" outer"}).attr("text-anchor",function(a){return(a.endAngle+a.startAngle)/2>Math.PI?"end":"start"}).text(function(a){return"outer"==a.data.group&&2<=a.data.display_val?a.data.display_val+"%":""});b=d.selectAll("g.arc.inner").data(e.value(function(a){return"inner"==a.group?h(a.val):0})).enter().append("svg:g").attr("class","arc inner").attr("transform",
"translate("+(c+50)+","+(c+50)+")");b.append("svg:path").attr("class",function(a){return a.data.type}).attr("d",l);b.append("svg:text").attr("transform",function(a,c){var b=l.centroid(a),d=b[0],b=b[1],e=Math.sqrt(d*d+b*b);console.log(c+" _x:"+d+" _y:"+b+" group "+a.data.group+" value "+a.display_val);console.log(a);return"translate("+d/e*j+","+b/e*j+")"}).attr("dy",".35em").attr("class",function(a){return"inner"==a.data.group&&0!=a.data.display_val?"text "+a.data.type+" inner":""}).attr("text-anchor",
function(){return"middle"}).text(function(a){return"inner"==a.data.group&&2<=a.data.display_val?a.data.display_val+"%":""})}};